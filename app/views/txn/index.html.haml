%h1= @page_title

%table.transaction_list
  %thead
    %tr
      %th Clear
      %th Txn ID
      %th Date
      %th User
      %th Category
      %th Amount
      %th Description
  %tbody
    - @transactions.each do |t|
      %tr{:class => cycle('odd', 'even') + (t.deleted_at ? ' deleted' : '') }
        %td
          %form{:method => "put", :action => '#'}
            - checked = t.reconciled ? {:checked => "1"} : {}
            %input{checked.merge(:type => "checkbox", :id => "txn_#{t.id}")}
        %td= t.id
        %td= t.ds
        %td= t.user.login
        %td= t.category.name
        %td.moneycolumn= currency_span(t.amount)
        %td
          %span{:id => "txn_desc_#{t.id}"}= t.descr

.txnsummary
  Showing
  = @transactions.length
  == #{maybe_singular(@transactions.length, "transactions")}.

%p
  Ending balance:
  = currency_span(@txn_sum, 'endingbal')
  %br
  Reconciled balance:
  = currency_span(@rec_sum, 'reconciled')
  %br
  Unreconciled balance:
  = currency_span(@unrec_sum, 'unreconciled')

%p= render :partial => 'links'

%script{:type => "text/javascript"}
  - rec_url = "/txn/current_reconciled/#{@current_acct.id}"
  == function updateReconciled() { new Ajax.Request('#{rec_url}' + "?" + Math.random(), {evalScripts: true}) }

  :plain
    function setup_reconciler(id) {
      $('txn_' + id).onclick=function() {
        var checked = ($('txn_' + id).checked) ? 1 : 0;
        new Ajax.Request('/txn/update/' + id + "?f=reconciled&value=" + checked, {
          method: "post",
          onSuccess: updateReconciled
        });
      }
    }
  - @transactions.each do |t|
    == setup_reconciler(#{t.id});
    == new Ajax.InPlaceEditor('txn_desc_#{t.id}', '/txn/update/#{t.id}?f=descr');